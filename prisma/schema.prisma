// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// ==================== USER MANAGEMENT ====================
model User {
  id           String        @id @default(uuid())
  clerkId      String        @unique
  email        String        @unique
  name         String
  username     String?       @unique
  avatar       String?
  isActive     Boolean       @default(true)
  lastLogin    DateTime?
  berita       Berita[]
  agenda       Agenda[]
  galeri       Galeri[]
  pengumuman   Pengumuman[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@map("users")
}

model DokumenPublik {
  id        String   @id @default(cuid())
  judul     String   // Contoh: "Formulir F-1.01 (Biodata)"
  url       String   // URL file dari Supabase
  path      String   // Path file di storage (untuk delete)
  ukuran    String   // Contoh: "120 KB"
  kategori  String   @default("Administrasi") // Opsional, jika nanti ada kategori lain
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ==================== BERITA ====================
model Berita {
  id            String          @id @default(uuid())
  judul         String
  slug          String          @unique
  konten        String          @db.Text
  excerpt       String?         @db.Text
  thumbnail     String?
  isPublished   Boolean         @default(false)
  isPinned      Boolean         @default(false)
  viewCount     Int             @default(0)
  authorId      String
  author        User            @relation(fields: [authorId], references: [id], onDelete: Cascade)
  kategoriId    String
  kategori      KategoriBerita  @relation(fields: [kategoriId], references: [id])
  publishedAt   DateTime?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([slug])
  @@index([kategoriId])
  @@index([publishedAt])
  @@map("berita")
}

model KategoriBerita {
  id          String   @id @default(uuid())
  nama        String
  slug        String   @unique
  deskripsi   String?
  icon        String?
  urutan      Int      @default(0)
  berita      Berita[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("kategori_berita")
}

// ==================== PROFIL KELURAHAN ====================
model ProfilKelurahan {
  id                String   @id @default(uuid())
  namaKelurahan     String
  kodePos           String?
  alamat            String   @db.Text
  nomorTelepon      String?
  email             String?
  website           String?
  
  // Sejarah & Visi Misi
  sejarah           String?  @db.Text
  visiMisi          String?  @db.Text
  
  // Data Geografis
  luasWilayah       String?
  batasUtara        String?
  batasSelatan      String?
  batasTimur        String?
  batasBarat        String?
  jumlahRW          Int?
  jumlahRT          Int?
  
  // Data Demografi
  jumlahPenduduk    Int?
  jumlahKK          Int?
  
  // Media Sosial
  facebook          String?
  instagram         String?
  twitter           String?
  youtube           String?
  
  // Logo & Gambar
  logo              String?
  gambarKantor      String?
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("profil_kelurahan")
}

// ==================== PENGUMUMAN ====================
model Pengumuman {
  id          String   @id @default(uuid())
  
  // Data Utama (Sesuai UI)
  judul       String   // Untuk judul besar: "Jadwal Pelayanan E-KTP..."
  slug        String   @unique // Untuk URL ramah SEO: /pengumuman/jadwal-e-ktp
  kategori    KategoriPengumuman @default(LAINNYA) // Tag biru: "PELAYANAN"
  isi         String   @db.Text // Deskripsi: "Jadwal dan lokasi mobil..."
  tanggal     DateTime @default(now()) // Tanggal di pojok kanan: "2023-10-24"
  
  // File Dokumen
  dokumenUrl  String?  // Link file untuk tombol "Unduh". Opsional (bisa null)
  
  // Metadata Admin
  isPublished Boolean  @default(true)
  authorId    String
  author    User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([slug])
}

enum KategoriPengumuman {
  PELAYANAN
  HIMBAUAN
  BERITA
  PERTEMUAN
  SOSIALISASI
  LAINNYA
}

// ==================== AGENDA ====================
model Agenda {
  id              String       @id @default(uuid())
  judul           String
  slug            String       @unique
  deskripsi       String       @db.Text
  lokasi          String
  tanggalMulai    DateTime
  tanggalSelesai  DateTime?
  waktuMulai      String?
  waktuSelesai    String?
  jenis           JenisAgenda  @default(KEGIATAN)
  penyelenggara   String?
  thumbnail       String?
  isPublished     Boolean      @default(false)
  authorId        String
  author          User         @relation(fields: [authorId], references: [id], onDelete: Cascade)
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  @@index([slug])
  @@index([tanggalMulai])
  @@map("agenda")
}

enum JenisAgenda {
  KEGIATAN
  RAPAT
  SOSIALISASI
  PELAYANAN
  LAINNYA
}

// ==================== GALERI KEGIATAN ====================
model Galeri {
  id          String        @id @default(uuid())
  judul       String
  slug        String        @unique
  deskripsi   String?       @db.Text
  tanggal     DateTime
  lokasi      String?
  thumbnail   String?
  isPublished Boolean       @default(false)
  authorId    String
  author      User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  foto        FotoGaleri[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  @@index([slug])
  @@index([tanggal])
  @@map("galeri")
}

model FotoGaleri {
  id          String   @id @default(uuid())
  galeriId    String
  galeri      Galeri   @relation(fields: [galeriId], references: [id], onDelete: Cascade)
  namaFile    String
  urlFile     String
  caption     String?
  urutan      Int      @default(0)
  createdAt   DateTime @default(now())

  @@index([galeriId])
  @@map("foto_galeri")
}

// ==================== PERANGKAT KELURAHAN ====================
model PerangkatKelurahan {
  id            String              @id @default(uuid())
  nama          String
  nip           String?             @unique
  jabatan       String
  jenisJabatan  JenisJabatan        @default(STAFF)
  foto          String?
  telepon       String?
  email         String?
  pendidikan    String?
  alamat        String?             @db.Text
  urutan        Int                 @default(0)
  isActive      Boolean             @default(true)
  mulaiJabatan  DateTime?
  akhirJabatan  DateTime?
  createdAt     DateTime            @default(now())
  updatedAt     DateTime            @updatedAt

  @@index([jabatan])
  @@map("perangkat_kelurahan")
}

enum JenisJabatan {
  LURAH
  SEKRETARIS
  KASI
  STAFF
  LAINNYA
}

// ==================== DOKUMEN PUBLIK ====================


enum KategoriPengaduan {
  INFRASTRUKTUR
  KEBERSIHAN
  KEAMANAN
  ADMINISTRASI
  PELAYANAN
  SOSIAL
  LAINNYA
}

enum StatusPengaduan {
  PENDING
  DIPROSES
  SELESAI
  DITOLAK
}
