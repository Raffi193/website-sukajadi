// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum PengaduanStatus {
  Pending
  Diproses
  Selesai
}

model User {
  id                String    @id @default(uuid()) @db.Uuid
  name              String?   @db.VarChar(255)
  email             String    @unique @db.VarChar(255)
  emailVerifiedAt   DateTime? @map("email_verified_at")
  password          String?   @db.VarChar(255)
  rememberToken     String?   @map("remember_token") @db.VarChar(100)
  createdAt         DateTime  @default(now()) @map("created_at")
  updatedAt         DateTime  @updatedAt @map("updated_at")

  @@map("users")
}

model Author {
  id        String   @id @default(uuid()) @db.Uuid
  name      String   @db.VarChar(255)
  username  String?  @db.VarChar(255)
  avatar    String?  @db.VarChar(255)
  bio       String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relasi
  news      News[]   @relation("AuthorNews")

  @@map("authors")
}

model NewsCategory {
  id        String   @id @default(uuid()) @db.Uuid
  title     String   @db.VarChar(255)
  slug      String   @unique @db.VarChar(255) // PERBAIKAN: Slug harus unik
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  news      News[]

  @@map("news_categories")
}

model News {
  id             String        @id @default(uuid()) @db.Uuid
  authorId       String?       @map("author_id") @db.Uuid
  newsCategoryId String?       @map("news_category_id") @db.Uuid
  title          String        @db.VarChar(255)
  slug           String        @unique @db.VarChar(255) // PERBAIKAN: Slug harus unik
  thumbnail      String?       @db.VarChar(255)
  content        String?       @db.Text
  isFeatured     Boolean       @default(false) @map("is_featured")
  createdAt      DateTime      @default(now()) @map("created_at")
  updatedAt      DateTime      @updatedAt @map("updated_at")
  
  // PERBAIKAN: BigInt diganti Int (Lihat penjelasan di bawah)
  views          Int           @default(0) 

  // Relations
  author         Author?       @relation("AuthorNews", fields: [authorId], references: [id])
  category       NewsCategory? @relation(fields: [newsCategoryId], references: [id])
  banners        Banner[]

  @@map("news")
}

model Banner {
  id        String   @id @default(uuid()) @db.Uuid
  newsId    String?  @map("news_id") @db.Uuid
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  news      News?    @relation(fields: [newsId], references: [id])

  @@map("banners")
}

model HomeBanner {
  id        String   @id @default(uuid()) @db.Uuid
  title     String   @db.VarChar(255)
  image     String   @db.VarChar(255)
  order     Int?
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("homebanners")
}

model DokumenDesa {
  id        String   @id @default(uuid()) @db.Uuid
  nama      String   @db.VarChar(255)
  file      String   @db.VarChar(255)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("dokumen_desas")
}

model ContactMessage {
  id        String   @id @default(uuid()) @db.Uuid
  nama      String   @db.VarChar(255)
  email     String   @db.VarChar(255)
  subjek    String?  @db.VarChar(255)
  pesan     String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("contact_messages")
}

model Pengaduan {
  id           String          @id @default(uuid()) @db.Uuid
  namaLengkap  String          @map("nama_lengkap") @db.VarChar(255)
  nik          String?         @db.VarChar(16)
  email        String?         @db.VarChar(255)
  telepon      String?         @db.VarChar(20)
  kategori     String?         @db.VarChar(255)
  isiPengaduan String?         @map("isi_pengaduan") @db.Text
  lampiran     String?         @db.VarChar(255)
  nomorTiket   String?         @unique @map("nomor_tiket") @db.VarChar(20) // PERBAIKAN: Tiket harus unik
  status       PengaduanStatus @default(Pending)
  createdAt    DateTime        @default(now()) @map("created_at")
  updatedAt    DateTime        @updatedAt @map("updated_at")

  @@map("pengaduans")
}
